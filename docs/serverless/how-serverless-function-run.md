# How serverless function run

#Serverless 无服务计算，字面意义，开发者并不知道他的代码在服务提供商中如何运行，所以在性能优化方面与以前的单入口应用会稍有差别。

## 函数生命周期

讨论如何优化程序性能时，我们首先要知道函数的是如何执行的，下面我们以AWS lambda为例:

1. 第一次请求到达时候，Lambda首先会下载代码，然后启动一个可运行lambda函数的环境，其中包含了指定语言的运行时环境，这个环境通常称为**cold start冷启动**
2. 然后代码在运行时环境中初始化，比如引入依赖(layer)，创建数据库链接等，这个过程为**部分冷启动**
3. 然后进入函数handler方法并开始执行逻辑，这个过程为**热启动**

[[what-is-serverless]]中提到的预配置并发原理就是**提前准备相应的函数执行环境**，解决1和2中产生的冷启动问题。

## 使用注意事项

1. 尽量不要在函数中使用`setTimeout`，`setInterval`等阻止函数事件循环结束的函数，在同步函数中会阻塞函数返回响应。
2. 在建立数据库连接时候，访问完数据库应马上关闭连接，同样会影响函数响应。
3. 处理文件上传，或者其他类选的数据时候，需要设置正确的数据响应格式和注意代码中的**数据类型转换**。